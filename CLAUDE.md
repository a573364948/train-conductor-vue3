# 列车长考核管理系统 - Claude开发指南

## 项目概述

这是一个基于Vue 3的列车长考核数据管理和分析系统，支持人员档案管理、考核记录、数据分析和报表生成。

## 技术栈

- **前端框架**: Vue 3 + TypeScript + Composition API
- **UI组件库**: Element Plus
- **状态管理**: Pinia
- **路由**: Vue Router 4
- **图表库**: ECharts + Vue-ECharts
- **构建工具**: Vite
- **样式**: SCSS
- **云服务**: Supabase (可选)
- **PWA**: 支持离线使用

## 常用命令

```bash
# 开发环境启动
npm run dev

# 类型检查
npm run type-check

# 构建生产版本
npm run build

# 跳过类型检查的快速构建
npm run build:skip-types

# 构建分析
npm run build:analyze

# 预览构建结果
npm run preview

# 清理缓存
npm run cleanup
```

## 核心目录结构

```
src/
├── components/           # 公共组件
├── composables/         # Vue组合式函数
├── layouts/             # 布局组件
├── router/              # 路由配置
├── stores/              # Pinia状态管理
├── styles/              # 全局样式
├── types/               # TypeScript类型定义
├── utils/               # 工具函数
└── views/               # 页面组件
    ├── dashboard/       # 仪表盘
    ├── personnel/       # 人员管理
    ├── assessment/      # 考核相关
    └── settings/        # 系统设置
```

## 核心文件

### 主要配置文件
- `vite.config.ts` - Vite配置，包含开发服务器、构建优化、PWA设置
- `src/router/index.ts` - 路由配置
- `src/main.ts` - 应用入口
- `package.json` - 依赖和脚本配置

### 关键Store文件
- `src/stores/index.ts` - 主要状态管理
- `src/stores/personnel.ts` - 人员管理状态
- `src/stores/authStore.ts` - 认证相关状态

### 重要组件
- `src/layouts/MainLayout.vue` - 主布局组件
- `src/views/dashboard/index.vue` - 仪表盘
- `src/views/personnel/components/PersonnelList.vue` - 人员列表
- `src/views/personnel/components/DataImport.vue` - 数据导入

## 开发环境设置

### 服务器配置
- **开发端口**: 3000
- **网络访问**: 支持局域网访问
- **HMR**: 启用热更新
- **内存限制**: 4GB (开发) / 8GB (构建)

### WSL环境注意事项
如果在WSL环境下开发：
```bash
# 确保服务器绑定到正确的网络接口
npm run dev

# 访问地址
# - 本地: http://localhost:3000/
# - 网络: http://[WSL-IP]:3000/
```

## 代码风格指南

### Vue组件规范
- 使用Composition API + `<script setup>`语法
- 使用TypeScript进行类型约束
- 组件名使用PascalCase
- 文件名使用kebab-case

### 状态管理规范
- 使用Pinia定义store
- Store文件使用camelCase命名
- 状态更新使用异步函数

### 样式规范
- 使用SCSS语法
- 支持暗色主题
- 移动端响应式设计
- 使用Element Plus主题色彩

## 已知问题和待办事项

### 高优先级问题
1. **PersonnelList.vue**: 
   - 导入缺失：`watch`未导入 (line 916)
   - 功能未实现：导出功能 (line 1039, 1167)
   - 批量操作未实现 (line 1234-1258)

2. **考核管理模块**:
   - 数据库访问缺乏空值检查
   - PDF/Excel导出功能不完整
   - 错误处理机制需要完善

3. **数据验证**:
   - 缺少数据完整性验证
   - 类型安全需要加强

### 中优先级问题
1. 性能优化：大量数据处理需要优化
2. 错误处理：需要统一的错误处理机制
3. 测试覆盖：缺少单元测试

### 低优先级问题
1. 代码注释：部分组件缺少JSDoc
2. 国际化：暂不支持多语言

## 数据结构

### 主要类型定义
```typescript
// 增强人员信息
interface EnhancedConductor {
  id: string
  name: string
  employeeId: string
  department: string
  status: '正式启用' | '临时启用' | '后备' | '免职'
  note?: string
  createdAt: number
  updatedAt: number
}

// 异动记录
interface PersonnelChange {
  id: string
  employeeId: string
  employeeName: string
  changeType: '状态变更' | '部门调动' | '职务调整' | '入职' | '离职' | '其他'
  fromStatus?: string
  toStatus?: string
  fromDepartment?: string
  toDepartment?: string
  changeDate: string
  reason: string
  operator: string
  notes?: string
  isAutoGenerated: boolean
  createdAt: number
  updatedAt: number
}
```

## 调试技巧

### 常用调试方法
1. **Vue DevTools**: 安装浏览器扩展进行组件调试
2. **Console日志**: 系统使用详细的console.log输出状态
3. **网络面板**: 检查API调用和数据加载

### 数据问题排查
```javascript
// 在浏览器控制台中检查数据状态
console.log('Store状态:', {
  database: mainStore.database,
  monthlyData: mainStore.monthlyData.length,
  departments: mainStore.departments
})
```

## 部署注意事项

### 生产环境构建
```bash
# 完整构建（包含类型检查）
npm run build

# 快速构建（跳过类型检查）
npm run build:skip-types
```

### 环境变量
- 开发环境自动加载`.env.local`
- 生产环境需要配置相应的环境变量

## 常见问题解决

### 服务器启动失败
```bash
# 清理缓存重试
npm run cleanup
npm install
npm run dev
```

### 类型错误处理
```bash
# 运行类型检查
npm run type-check

# 如需快速构建，可跳过类型检查
npm run build:skip-types
```

### WSL网络访问问题
- 确保防火墙允许3000端口
- 使用`host: true`配置（已在vite.config.ts中设置）

## 数据备份和恢复

系统支持数据导入导出功能：
- 人员档案数据可以通过DataImport组件导入
- 支持JSON格式的数据备份
- 云端同步功能（需要配置Supabase）

## 项目特殊行为

1. **本地化存储**: 使用IndexedDB完全本地化存储，无云服务依赖
2. **移动端优化**: 自动检测设备类型并调整布局
3. **PWA支持**: 支持离线使用和应用安装
4. **内存管理**: 大文件处理时会自动调整内存限制
5. **热更新**: 开发时支持组件热更新，提升开发效率

## 云服务状态

**当前状态**: 已完全移除Supabase云服务功能 (commit: 03f7d78)
- ❌ 云端数据同步已移除
- ✅ 完全本地化IndexedDB存储
- ✅ JSON格式数据导入导出
- ✅ 离线优先架构

---

**最后更新**: 2025-06-24
**维护者**: Claude Code Assistant